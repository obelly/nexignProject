# nexignProject
## Задание: 
Файл CDR (Call Data Record) собирается на коммутаторе - оборудовании, обрабатывающем звонки. Этот файл содержит следующую обязательную информацию:

тип вызова (01 -исходящие, 02 -входящие)

номер абонента•дата и время начала звонка (YYYYMMDDHH24MMSS)

дата и время окончания звонка

Вот пример готовой записи cdr:  02,79876543221,20230321160455,20230321163211

CDR принимает BRT (Billing Real Time). Получив данные из CDR BRT авторизует абонентов оператора "Ромашка", чей баланс больше 0. Для этого BRT связывается с базой клиентов, в которой есть информация об абоненте: номер, тариф, баланс.

Поддерживается 3 тарифа:

(06) Безлимит 300: 300 минут - за тарифный период стоят фиксированную сумму -100р. Каждая последующая минута - 1р.
(03) Поминутный: 1 минута разговора - 1.5 рубля.
(11) Обычный: Входящие - бесплатно, исходящие - первые 100 минут по 0.5р/минута, после по тарифу "поминутный".

После авторизации BRT генерирует файл CDR+, который содержит уже информацию о тарифе абонента и передает его в HRS (High performance rating server). HRS считает сколько денег нужно списать со счета абонента, исходя из длительности его разговоров и выбранного тарифа и возвращает данные в BRT, который вносит изменения в базу и меняет баланс пользователя на соответствующую сумму.

## Технологии:
Java 17, Spring(Boot, Data, Security, Cloud)
PostgreSQL, Maven, Docker

## Архитектура приложения

Приложение состоит из 4-х модулей:
### CDR-service
В этом сервисе генерируются файлы cdr.txt со случайными call data records.
Call data records создаются на основе, полученных номеров телефонов из базы данных BRT-service.

### BRT-service
При получении файла cdr.txt сервис авторизует пользователей оператора, чей баланс больше 0, генерирует
Call data record+, который к имеющимся cdr добавляет тариф.
Файл cdr+ отправляется в HRS-service, который возвращает сведения о стоимости, оказанных услуг.
На основе полученной информации, BRT-service вносит изменения баланса пользователя в базу данных.

### HRS-service
При получении файла cdr+, рассчитывает продолжительность и стоимость каждого звонка, возвращает
общую стоимость, оказанных услуг.

### CRM-service
Сервис отвечает за переадресацию запросов от клиента к другим сервисам.
Есть два уровня прав:
- Абонент (пополнение счета, получение детализации звонков)
- Менеджер (смена тарифа пользователя, создание нового пользователя, выполнение тарификации)

